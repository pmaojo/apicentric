name: Pets API
version: "1.0"
description: Pet service with fixtures and template rendering
server:
  port: 9002
  base_path: /api/v1
  cors:
    enabled: true
    origins: ["*"]

fixtures:
  pets:
    - id: 1
      name: "Max"
      type: "dog"
      breed: "Labrador"
      age: 3
      available: true
    - id: 2
      name: "Luna"
      type: "cat"
      breed: "Siamese"
      age: 2
      available: true
    - id: 3
      name: "Buddy"
      type: "dog"
      breed: "Golden Retriever"
      age: 5
      available: false

endpoints:
  - method: GET
    path: /pets
    responses:
      200:
        content_type: application/json
        body: |
          {
            "pets": {{ json fixtures.pets }},
            "total_count": {{ length fixtures.pets }},
            "available_count": {{ length (filter fixtures.pets "available" true) }}
          }

  - method: GET
    path: /pets/{id}
    responses:
      200:
        content_type: application/json
        body: |
          {
            "id": {{ params.id }},
            "name": "{{#with (find fixtures.pets "id" params.id)}}{{name}}{{/with}}",
            "type": "{{#with (find fixtures.pets "id" params.id)}}{{type}}{{/with}}",
            "breed": "{{#with (find fixtures.pets "id" params.id)}}{{breed}}{{/with}}",
            "age": {{#with (find fixtures.pets "id" params.id)}}{{age}}{{/with}},
            "available": {{#with (find fixtures.pets "id" params.id)}}{{available}}{{/with}}
          }

  - method: GET
    path: /pets/available
    responses:
      200:
        content_type: application/json
        body: |
          {
            "available_pets": [
              {{#each fixtures.pets}}
                {{#if this.available}}
                  {
                    "id": {{this.id}},
                    "name": "{{this.name}}",
                    "type": "{{this.type}}"
                  }
                  {{#unless @last}},{{/unless}}
                {{/if}}
              {{/each}}
            ]
          }
